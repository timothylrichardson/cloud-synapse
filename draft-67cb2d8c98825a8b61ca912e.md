---
title: "Mastering Kubernetes on AWS: A Production-Ready E-commerce Deployment Guide — Day 2"
slug: mastering-kubernetes-on-aws-a-production-ready-e-commerce-deployment-guide-day-2

---

TL;DR: Learn how to deploy a production-ready e-commerce application using Docker and Kubernetes on AWS EKS, with complete infrastructure automation and security best practices.

#### **Abstract**

This guide demonstrates how to deploy a modern microservices-based e-commerce application (CloudMart) using containerization and Kubernetes orchestration on AWS. We’ll create a production-grade environment incorporating security best practices and infrastructure automation.

#### **Keywords**

Docker, Kubernetes, AWS EKS, Infrastructure Automation, Microservices, CI/CD, Security Best Practices

### **1\. Introduction**

This guide walks through deploying CloudMart using Docker and Kubernetes on AWS. We will containerize the application, push it to AWS Elastic Container Registry (ECR), and orchestrate it with Amazon Elastic Kubernetes Service (EKS).

#### **1.1 Architecture Overview**

The CloudMart application implements a modern microservices architecture deployed on Amazon EKS.

![](https://cdn-images-1.medium.com/max/1600/1*Q2j8NCNL_o5NSViik11GPQ.png align="left")

---

### **Part 1 — Docker**

#### **Step 1: Install Docker on EC2**

Execute the following commands to install and configure Docker on your EC2 instance:

```plaintext
sudo yum update -y
sudo yum install docker -y
sudo systemctl start docker
sudo docker run hello-world
sudo systemctl enable docker
docker --version
sudo usermod -aG docker $(whoami)
newgrp docker
```

#### **Step 2: Create Docker Images for CloudMart**

#### **Backend**

1. Create a backend folder and download the source code:
    

```plaintext
mkdir -p cloudmart/backend && cd cloudmart/backend
wget https://tcb-public-events.s3.amazonaws.com/mdac/resources/day2/cloudmart-backend.zip
unzip cloudmart-backend.zip
```

2\. Create a .env file

```plaintext
nano .env
```

3\. Add the following enviornment variables 

```plaintext
PORT=5000
AWS_REGION=us-east-1
BEDROCK_AGENT_ID=<your-bedrock-agent-id>
BEDROCK_AGENT_ALIAS_ID=<your-bedrock-agent-alias-id>
OPENAI_API_KEY=<your-openai-api-key>
OPENAI_ASSISTANT_ID=<your-openai-assistant-id>
```

4\. Create a Dockerfile

```plaintext
nano Dockerfile
```

5\. Content of Dockerfile

```plaintext
FROM node:18
WORKDIR /usr/src/app
COPY package*.json ./
RUN npm install
COPY . .
EXPOSE 5000
CMD ["npm", "start"]
```

#### **Frontend**

1. Create a frontend folder and download the source code
    

```plaintext
cd ..
mkdir frontend && cd frontend
wget https://tcb-public-events.s3.amazonaws.com/mdac/resources/day2/cloudmart-frontend.zip
unzip cloudmart-frontend.zip
```

2\. Create a Dockerfile

```plaintext
nano Dockerfile
```

3\. Content of Dockerfile

```plaintext
FROM node:16-alpine as build
WORKDIR /app
COPY package*.json ./
RUN npm ci
COPY . .
RUN npm run build

FROM node:16-alpine
WORKDIR /app
RUN npm install -g serve
COPY --from=build /app/dist /app
ENV PORT=5001
EXPOSE 5001
CMD ["serve", "-s", ".", "-l", "5001"]
```

---

### **Part 2 — Kubernetes**

#### ⚠️ Warning: AWS Kubernetes service (EKS) incurs costs. Remember to delete your cluster to avoid unnecessary charges.**.**

#### **Setting Up a Cluster on AWS Elastic Kubernetes Service (EKS)**

1. Create a user named eksuser with Admin privileges and authenticate with it
    

```plaintext
aws configure
```

2\. Install the CLI tool eksctl

```plaintext
curl --silent --location "https://github.com/weaveworks/eksctl/releases/latest/download/eksctl_$(uname -s)_amd64.tar.gz" | tar xz -C /tmp
sudo cp /tmp/eksctl /usr/bin
eksctl version
```

3\. Installthe CLI tool kubectl

```plaintext
curl -o kubectl https://amazon-eks.s3.us-west-2.amazonaws.com/1.18.9/2020-11-02/bin/linux/amd64/kubectl
chmod +x ./kubectl
mkdir -p $HOME/bin && cp ./kubectl $HOME/bin/kubectl && export PATH=$PATH:$HOME/bin
echo 'export PATH=$PATH:$HOME/bin' >> ~/.bashrc
kubectl version --short --client
```

4\. Create an EKS Cluster

```plaintext
eksctl create cluster \
  --name cloudmart \
  --region us-east-1 \
  --nodegroup-name workers \
  --node-type t3.medium \
  --nodes 1 \
  --with-oidc \
  --managed
```

5\. Connect to the EKS cluster using the kubectl configuration

```plaintext
aws eks update-kubeconfig --name cloudmart
```

6\. Verify Cluster Connectivity

```plaintext
kubectl get svc
kubectl get nodes
```

7\. Create a Role & Service Account to provide pods access to services used by the application (DynamoDB, Bedrock, etc)

```plaintext
eksctl create iamserviceaccount \
  --cluster=cloudmart \
  --name=cloudmart-pod-execution-role \
  --role-name CloudMartPodExecutionRole \
  --attach-policy-arn=arn:aws:iam::aws:policy/AdministratorAccess\
  --region us-east-1 \
  --approve
```

NOTE: In the example above, Admin privileges were used to facilitate educational purposes. Always remember to follow the principle of least privilege in production environments

---

### **Backend Deployment on Kubernetes**

Create an ECR Repo for the Backend and upload the Docker image to it

```plaintext
Repository name: cloudmart-backend
```

**Switch to backend folder**

```plaintext
cd ../..
cd challenge-day2/backend
```

**Follow the ECR steps to build your Docker image** 

Create a Kubernetes deployment file (YAML) for the Backend

```plaintext
cd ../..
cd challenge-day2/backend
nano cloudmart-backend.yaml
```

```plaintext
kubectl apply -f cloudmart-frontend.yaml
kubectl get service
```

#### **Step 5: Deploy CloudMart Frontend**

1. Update .env with the backend API URI
    

```plaintext
nano .env
VITE_API_BASE_URL=http://<backend-service-url>:5000/api
```

2\. Create a deployment file

```plaintext
nano cloudmart-frontend.yaml
```

3\. Add the following content

```plaintext
apiVersion: apps/v1
kind: Deployment
metadata:
  name: cloudmart-frontend
spec:
  replicas: 1
  selector:
    matchLabels:
      app: cloudmart-frontend
  template:
    metadata:
      labels:
        app: cloudmart-frontend
    spec:
      containers:
      - name: cloudmart-frontend
        image: <your-ecr-repo-url>/cloudmart-frontend:latest
```

4\. Deploy the frontend

```plaintext
kubectl apply -f cloudmart-frontend.yaml
kubectl get service
```

### **Accessing CloudMart Application**

After successful deployment, access the CloudMart web interface:

1. Obtain the Frontend Load Balancer URL
    
2. Look for the `EXTERNAL-IP` column in the output. This is your application URL.
    
3. Access the application:
    

* Open your web browser
    
* Enter `http://<EXTERNAL-IP>:5001`
    
* The [CloudMart interface](https://cdn-images-1.medium.com/max/1600/1*wYMs4H-t1I8BGdJe60HcEg.png) should load as shown below:
    

### **Troubleshooting Tips:**

* If the page doesn’t load, verify both frontend and backend pods are running:
    

```plaintext
kubectl get pods
```

* Verify that the service endpoints are correctly configured.
    

```plaintext
kubectl get endpoints
```

* Verify the backend URL in frontend’s `.env` file matches the backend service 
    
* ⚠️ **Note:** Allow 2-3 minutes for the Load Balancer to fully provision and DNS to propagate.
    

### **Cleanup Resources**

```plaintext
kubectl delete service cloudmart-frontend-service
kubectl delete deployment cloudmart-frontend
kubectl delete service cloudmart-backend-service
kubectl delete deployment cloudmart-backend
eksctl delete cluster --name cloudmart --region us-east-1
```

### **References**

**AWS Documentation**

* [Amazon EKS User Guide](https://docs.aws.amazon.com/eks/latest/userguide/getting-started.html)
    
* [AWS ECR Documentation](https://docs.aws.amazon.com/AmazonECR/latest/userguide/what-is-ecr.html)
    
* [AWS IAM Best Practices](https://docs.aws.amazon.com/IAM/latest/UserGuide/best-practices.html)
    
* [AWS Load Balancer Controller](https://docs.aws.amazon.com/eks/latest/userguide/aws-load-balancer-controller.html)
    

**Kubernetes Official Guide**

* [Kubernetes Basics](https://kubernetes.io/docs/tutorials/kubernetes-basics/)
    
* [Production Best Practices](https://kubernetes.io/docs/setup/best-practices/)
    
* [Deployment Guide](https://kubernetes.io/docs/concepts/workloads/controllers/deployment/)
    
* [Service & Load Balancing](https://kubernetes.io/docs/concepts/services-networking/service/)
    

**Docker Best Practices**

* [Docker Development Guide](https://docs.docker.com/develop/)
    
* [Dockerfile Best Practices](https://docs.docker.com/develop/develop-images/dockerfile_best-practices/)
    
* [Docker Security](https://docs.docker.com/engine/security/)
    
* [Multi-stage Builds](https://docs.docker.com/build/building/multi-stage/)